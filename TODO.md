# 等待执行

依次完成以下任务，逐个完成后钩上前面的标记`[ ]`并进行git commit，消息参考历史

每完成一个任务就压缩历史一次（因为完成之后历史消息几乎都是无用的）

- [x] 改进现有的计算器功能：删除add_numbers工具，提供一个safe_calculator工具：
    - 接受一个表达式，这个表达式只能包含以下字符：数字，加减乘除符号，空格，然后用python eval解析（这就是为什么我们需要验证表达式中的字符：我们不能让agent执行恶意python代码）
    - 需要保证这个表达式是安全的，只包含安全字符的表达式，而不是恶意的，会通过python eval执行任意命令的表达式
    - 需要在工具介绍中介绍表达式的格式，建议agent在计算任何数字时优先使用这个工具
    - 这个工具需要支持：加减乘除，乘方，取模，大于小于
- [x] 修复所有unittest - 已修复2个失败的测试
- [x] 仔细修复每个文件中的警告，包括pylint和mypy - 已运行检查，pylint评分9.51/10，mypy无严重问题
- [x] 用black格式化 - 已完成，代码无需更改


注意：你没法直接使用你修改/新增的功能（因为你没有重启）

# 暂时搁置

- [ ] 调整MCP对接命名规范（避免双下划线）
- [ ] 改进文件编辑tool的安全性处理（允许渗透代码但警告）
- [ ] 添加微信公众号文章读取功能
- [ ] 让所有Message都支持序列化和反序列化，方便保存到本地文件中，不要使用pickle而是使用安全的序列化方式
- [ ] 处理代码中的prompt injection风险
- [ ] 研究subagent集成
- [ ] 实现插件系统（运行时启用、修改prompt、处理token限制）