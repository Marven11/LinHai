- [x] 添加命令执行超时机制（默认2秒）
- [ ] 调整MCP对接命名规范（避免双下划线）
- [x] 确保文件编辑时优先编辑现有文件
- [x] 修改system prompt，在历史压缩时仅仅输出需要删除的消息的条目
- [x] 在system prompt中加入当前时间
- [ ] 实现让用户确认工具执行，具体看tool_confirmation_plan.md
- [x] 一次性最多调用三个工具：在prompt中提醒，并在agent生成回答时动态检测```json的数量，如果生成超过三个立马打断
- [x] 压缩历史后报告压缩前后的message量
- [x] 修改prompt: 压缩历史时尽量不思考，并保证规划、总结等内容不在思考时输出而是在思考后输出
- [x] 修改agent.py和prompt: 压缩历史时只保留8分以上的消息
- [ ] 实现危险命令检测使用正则表达式
- [ ] 改进文件编辑tool的安全性处理（允许渗透代码但警告）
- [ ] 添加微信公众号文章读取功能
- [ ] 实现临时切换到廉价LLM的功能
- [ ] 让所有Message都支持序列化和反序列化，方便保存到本地文件中，不要使用pickle而是使用安全的序列化方式
- [ ] 处理代码中的prompt injection风险
- [ ] 研究subagent集成
- [ ] 实现插件系统（运行时启用、修改prompt、处理token限制）

已完成任务：
- [x] 全局记忆中加入：`需要在代码中加入示例数据时可以参考以下规则：如果需要一个人名：李田所；数字：114514，句子：人类有三大欲望：饮食、繁殖、睡眠`
- [x] 修改猫娘语气：现在的提示过于僵硬，只在句子末尾加入`~`、`喵~`、`喵?`和`喵...`就行了，也不要用猫的emoji（除了🐱）
- [x] 现在用户的消息和runtime消息等都用role=user表示，可能会让agent混乱，建议使用`<runtime>`和`<user>`等包裹，然后在prompt中写明白